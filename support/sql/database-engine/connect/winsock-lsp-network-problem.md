---
title: Winsock LSP may result in network problems
description: This article helps you resolve the problem that occurs when Winsock Layered Service Providers (LSP) are loaded into SQL Server address space.
ms.date: 09/25/2020
ms.custom: sap:Database Connectivity and Authentication
ms.reviewer: SureshKa
---
# Winsock Layered Service Providers may result in network or server stability problems for SQL Server

This article helps you resolve the problem that occurs when Winsock Layered Service Providers (LSP) are loaded into SQL Server address space.

_Original product version:_ &nbsp; Microsoft SQL Server 2005, SQL Server 2008  
_Original KB number:_ &nbsp; 2033448

## Symptoms

You notice abrupt hang or termination of all network communications between SQL Server and the client applications. This can cause SQL Server to become unresponsive and cause service failures. You might receive exceptions whose call stacks involve manipulating data structures that are maintained or used by the modules loaded into the SQL Server address space. These problems are typically followed by error messages generated by the SQL Server Scheduler, such as errors 17883 and 17882.

## Cause

A Winsock LSP DLL can be loaded into the SQL Server processes and can intercept and monitor network communications (including TDS packets) at the Winsock level between the client applications and SQL Server. This occurs when Network Monitoring Agents are installed on a computer that is running SQL Server and this computer is chosen for monitoring network use for monitoring performance counters by a Managed Service Provider.

## Resolution

Execute the following command from a command prompt to find out the list of all Winsock LSPs that are installed on the computer that is running SQL Server:

```console
Netsh winsock show catalog
```

Execute the following query to find out which of these installed LSPs are loaded into the SQL Server process:

```sql
SELECT [name],[company],[file_version],[product_version]
FROM sys.dm_os_loaded_modules 
WHERE company NOT LIKE 'Microsoft%' OR company is NULL
```

If you have a business requirement to use these providers, ensure that you have the latest updates installed for these providers. If possible avoid monitoring SQL Server-related traffic and avoid loading these modules into the SQL Server process. Alternately you could exclude this server from the monitoring process.

## More information

- [Winsock architecture](/previous-versions/windows/embedded/ms885821(v=msdn.10))
- [Transport Service Providers](/windows/win32/winsock/transport-service-providers-2)

